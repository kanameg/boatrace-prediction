## 競走成績・番組表ダウンロードスクリプト仕様書

### 概要
このスクリプトは、指定されたURLから、lzh形式で圧縮された競走成績および番組表をダウンロードします。ダウンロード後圧縮ファイルを解凍します。解凍されたファイルは、Shift-JISエンコーディングのため、UTF-8に変換します。

### 言語
bashスクリプト

### 起動方法
```bash
./download_race.sh [p|r] YYYY MM DD
```
ここで、pは番組表、rは競走成績を指定します。`YYYY`は年4桁、`MM`は1桁または2桁の月(0埋めも許可)、`DD`は1桁または2桁の日(0埋めも許可)を表します。

### ダウンロード処理
wgetコマンドを使用して、指定されたURLからlzh形式の圧縮ファイルをダウンロードします。ダウンロードしたファイルは、カレントディレクトリに一時的に保存されます。（後ほど消去）
指定URLは、競走結果と番組表で異なります。
- 競走成績: `https://www1.mbrace.or.jp/od2/K/{YYYY}{MM}/k{YY}{MM}{DD}.lzh`
- 番組表: `https://www1.mbrace.or.jp/od2/B/{YYYY}{MM}/b{YY}{MM}{DD}.lzh`
ここで、{YYYY}は年4桁、{MM}は月2桁0埋め、{YY}は年の下2桁、{MM}は月2桁0埋め、{DD}は日2桁0埋めを表します。

### 解凍処理
解凍には`lha`コマンドを使用します。解凍後、ファイルはカレントディレクトリに一時保存されます。（文字コード変換後に削除予定）
正常に解凍された場合、元のアーカイブファイルは削除します。

### 文字コード変換
解凍されたファイルはShift-JISエンコーディングで保存されているため、`iconv`コマンドを使用してUTF-8に変換します。変換後のファイルは番組表と競走結果でそれぞれ以下のディレクトリに以下のファイル名で保存します。
- 番組表: `data/raw/programs`
- 競走成績: `data/raw/results`

- 番組表の保存ファイル名は、`b{YY}{MM}{DD}_u8.txt`の形式で、{YY}は年の下2桁、{MM}は月2桁0埋め、{DD}は日2桁0埋めを表します。
- 競走成績の保存ファイル名は、`k{YY}{MM}{DD}_u8.txt`の形式で、{YY}は年の下2桁、{MM}は月2桁0埋め、{DD}は日2桁0埋めを表します。
正常に変換された場合、元のShift-JISファイルは削除します。

### エラーハンドリング
- 起動時に引数が不足している場合、エラーメッセージを表示して終了します。
- 引数に無効な値が含まれている場合、エラーメッセージを表示して終了します。
- ダウンロードに失敗した場合、エラーメッセージを表示して終了します。
- 解凍に失敗した場合、エラーメッセージを表示して終了します。
- 文字コード変換に失敗した場合、エラーメッセージを表示して終了します。


## 範囲指定ダウンロードスクリプト
### 概要
このスクリプトは、指定された期間の競争成績と番組表を一括でダウンロードします。期間は開始日と終了日で指定します。
ダウンロードには、`download_race.sh`スクリプトを使用します。

### 言語
bashスクリプト

### 起動方法
```bash
./download_races_range.sh [p|r] YYYY MM DD YYYY MM DD
```
ここで、pは番組表、rは競走成績を指定します。最初の`YYYY MM DD`は開始日、次の`YYYY MM DD`は終了日を表します。年は4桁、月と日は1桁または2桁の数字（0埋めも許可）で指定します。

### ダウンロード処理
指定された期間の各日付に対して、`download_race.sh`スクリプトを呼び出してレース結果をダウンロードします。
ダウンロードは、サーバーに負荷をかけないように、1日ごとに行い、ダウンロードの間隔は1秒とします。

### エラーハンドリング
- 引数が不足している場合、エラーメッセージを表示して終了します。
- 引数に無効な値が含まれている場合、エラーメッセージを表示して終了します。
- 開始日が終了日より後の場合、エラーメッセージを表示して終了します。
- 各日付のダウンロードに失敗した場合、エラーメッセージを表示して終了します。
